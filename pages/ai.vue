<template>
  <div>
    <div class="text-center max-w-5xl mx-auto">
      <h1
        class="text-2xl sm:text-3xl md:text-5xl font-medium"
        v-html="$t('ai.title', tColorsRed)"
      ></h1>
      <h2
        class="inline-flex items-center text-base mt-6 text-gray-600 dark:text-gray-300"
        v-html="$t('ai.subtitle', tBlockRed)"
      ></h2>

      <p
        class="max-w-4xl px-6 leading-loose md:leading-loose mx-auto mt-6 md:text-xl"
      >
        {{ $t("ai.description") }}
      </p>
    </div>

    <svg
      xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      fill="none"
      viewBox="0 0 144 24"
      class="mx-auto mt-8 -mb-6 w-[300px] max-w-[60%]"
    >
      <path
        class="fill-gray-400"
        d="M36 19H36c-.2 0-.4-.1-.4-.4l-.2-1.3a42.6 42.6 0 0 1 0-1.8c-.7 0-1.1 0-1.1-.2V15h1.2a22.2 22.2 0 0 0-.1-2.1v-.2h.3l.2.1v.3L36 15h.8l.4.1.1.3-.5.1H36l.1 3v.5Zm2.6 0c-.2-.5-.5-1.2-.6-1.9-.2-.7-.2-1.3-.2-1.9l.1-.3.1-.1.1.1.1.4v.4c.1-.4.3-.7.5-.9.2-.2.4-.3.7-.3.4 0 .6 0 .8.2.2.1.3.3.3.6l-1-.2a1 1 0 0 0-.6.2c-.2.1-.3.4-.4.6a1.7 1.7 0 0 0 0 1l.2.6.2.6.1.6v.2l-.4.1Zm5 4.7c-.5 0-.9 0-1.2-.3a3 3 0 0 1-.9-.6l-.3-.7v-.3c.2 0 .3-.1.4 0 .2.4.5.8.8 1 .3.3.7.5 1.2.5.4 0 .7-.3.9-.8.2-.4.4-1 .5-1.7a15.4 15.4 0 0 0 0-3c-.4.7-1 1-1.9 1-.6 0-1.2-.3-1.5-1a6 6 0 0 1-.7-2.5c0-.4 0-.6.4-.6v.5l.3 1.4c.2.4.3.8.6 1.1.2.4.6.6 1 .6.3 0 .6-.1 1-.4.3-.2.6-.4.7-.7 0-.5 0-1-.2-1.3a41 41 0 0 1-.1-1.3h.2s.2.1.3.5l.3 1.5a19.1 19.1 0 0 1 .2 2.7 9 9 0 0 1-.5 3.2c-.3.8-.8 1.2-1.5 1.2Zm7-4.7h-.2c-.2 0-.4-.1-.4-.4l-.1-1.3a42.6 42.6 0 0 1 0-1.8c-.8 0-1.2 0-1.2-.2V15h1.1a22.1 22.1 0 0 0 0-2.1v-.2h.3l.2.1v.3l.1 1.8h.9l.3.1.1.3-.4.1h-.9l.1 3v.5Zm2.8 0-.1-.4a47.3 47.3 0 0 1-.5-4.2 17 17 0 0 0-.4-2.3l.3-.2.4 1.3.2 1.2v.4l1.2-.3c.6 0 1 .2 1.3.8.2.5.3 1.3.3 2.3v1c0 .3-.1.4-.2.4 0 0-.2 0-.3-.2v-2.2c0-.5-.1-.9-.3-1.2-.2-.2-.5-.3-1-.3-.3 0-.6 0-.8.3a10.4 10.4 0 0 0 0 1.5 16.4 16.4 0 0 1 .2 1.9l-.1.1h-.2Zm6 0c-.4 0-.8 0-1.2-.3-.4-.1-.6-.4-.9-.7-.2-.3-.3-.6-.3-1 0-.5.1-.9.3-1.3.1-.4.4-.7.7-1 .3-.1.7-.3 1.1-.3.5 0 .8.2 1 .5.3.3.4.6.4 1 0 .5-.2.8-.5 1a2 2 0 0 1-1.2.3h-.3L58 17l-.1-.2v-.1H59.1c.6 0 1-.2 1-.8 0-.3-.2-.5-.3-.7 0-.2-.3-.3-.6-.3s-.6 0-.8.3c-.3.1-.5.3-.6.6a2 2 0 0 0-.2.9c0 .5.1 1 .4 1.3.3.3.8.5 1.4.5h.6a11.1 11.1 0 0 1 .9-.3h.2c-.2.3-.4.5-.8.6a3 3 0 0 1-1 .2Zm2.1-1.2h.5c.1 0 .2 0 .3.2l.2.1.6.3h.9l.9-.1c.2-.1.4-.3.4-.5s0-.4-.2-.5l-.6-.3-.8-.1-1-.2c-.4 0-.6-.2-.7-.4-.2-.2-.3-.4-.3-.8 0-.3.2-.6.5-.8l1.2-.3c.4 0 .7.1 1 .3.3.2.5.4.5.7l-.1.5-.3.1-.1-.2v-.4c0-.1 0-.2-.3-.3l-.6-.1c-.4 0-.7 0-.9.2-.2.1-.3.3-.3.5s0 .3.2.4l.6.2 1 .2.8.1c.3.1.5.2.6.4.2.2.2.5.2.8 0 .4-.1.7-.5.9-.3.2-.7.3-1.2.3a4 4 0 0 1-1.6-.3c-.5-.2-.8-.5-.9-.9ZM69 19c-.4 0-.8 0-1.1-.3-.4-.1-.7-.4-.9-.7-.2-.3-.3-.6-.3-1 0-.5 0-.9.2-1.3s.4-.7.8-1c.3-.1.7-.3 1.1-.3.5 0 .8.2 1 .5.3.3.4.6.4 1 0 .5-.2.8-.5 1a2 2 0 0 1-1.2.3h-.3c-.3 0-.4-.1-.5-.2l-.2-.2v-.1H68.8c.6 0 .9-.2.9-.8 0-.3 0-.5-.2-.7-.1-.2-.3-.3-.6-.3s-.6 0-.9.3l-.6.6a2 2 0 0 0-.2.9c0 .5.2 1 .5 1.3.3.3.7.5 1.3.5h.7a11.1 11.1 0 0 1 .8-.3h.3c-.2.3-.4.5-.8.6a3 3 0 0 1-1 .2Zm7 0c-.4 0-.8 0-1.2-.3-.3-.1-.6-.4-.8-.7-.2-.3-.3-.6-.3-1 0-.5 0-.9.2-1.3l.7-1 1.2-.3c.4 0 .8.2 1 .5.3.3.4.6.3 1 0 .5-.1.8-.4 1a2 2 0 0 1-1.2.3h-.3c-.3 0-.4-.1-.5-.2l-.2-.2v-.1h1.2c.7 0 1-.2 1-.8l-.2-.7c-.1-.2-.3-.3-.6-.3-.4 0-.6 0-.9.3l-.6.6a2 2 0 0 0-.2.9c0 .5.2 1 .5 1.3.3.3.7.5 1.3.5h.7a11.3 11.3 0 0 1 .8-.3h.2c-.1.3-.4.5-.7.6a3 3 0 0 1-1 .2Zm4-2a12 12 0 0 1 1.8 1.9l-.1.2h-.3a8.5 8.5 0 0 1-1.2-1.2l-.5-.5-.6.8-.4.5-.2.2h-.2l-.1-.2v-.1a16.9 16.9 0 0 1 1.1-1.4l-.7-.8a16 16 0 0 1-.9-1c0-.1 0-.2.2-.2l.2-.1a53.2 53.2 0 0 1 1.6 1.6l.2-.2 1-1c.3-.3.5-.4.7-.4.1 0 .2 0 .3.2l-.3.3a28.8 28.8 0 0 1-1.6 1.4Zm5.2 2c-.7 0-1.3-.1-1.8-.4-.5-.2-.8-.6-.8-1.3l.2-.6.6-.5a2 2 0 0 1 1-.2h.7l.7.3c.3 0 .5.3.8.5a4 4 0 0 0-.5-1.2l-.7-.8c-.3-.2-.5-.3-.8-.3l-.3.1-.4.2-.3.1h-.1c0-.3 0-.5.3-.7l.9-.2c.4 0 .8.2 1.2.6.4.4.7.8 1 1.4a4.2 4.2 0 0 1 .3 2h-.4c-.2-.6-.5-1-1-1.1-.3-.3-.7-.4-1.1-.4-.5 0-1 .1-1.1.3-.2.1-.4.3-.4.6s.2.6.5.8l1.2.2h.6a5.6 5.6 0 0 0 .9-.2 2.3 2.3 0 0 1 .8 0v.2l-.4.2a8 8 0 0 1-1.6.4Zm9.3 0h-.2v-.6l.1-1c0-.6-.1-1-.3-1.4-.2-.4-.6-.6-1-.6-.3 0-.5 0-.8.2a2 2 0 0 0-.6.5c-.2.2-.2.3-.2.5a5.8 5.8 0 0 0 .2 1l.1.5v.2l-.1.1c-.2 0-.3 0-.4-.2l-.2-.8-.3-1-.4-.5a.8.8 0 0 0-.6-.3 1 1 0 0 0-.8.4c-.2.2-.3.5-.3.8v1l.1.6v.3l-.2.1-.3-.1v-.4a17.7 17.7 0 0 0-.2-1.9v-1.1l.2-.1.1.1.1.4.5-.4c.1-.2.4-.3.6-.3l.9.3.6.7a2.4 2.4 0 0 1 2-1.2c.5 0 .8.1 1 .4.4.4.6.7.7 1.2a4.2 4.2 0 0 1 .1 2.2c0 .3-.2.4-.4.4Zm2.5 3.6c-.2 0-.3-.4-.5-1.1a30.3 30.3 0 0 1-.7-4c0-.7.2-1.2.7-1.5a3 3 0 0 1 1.7-.5c.4 0 .8.1 1.1.3a1.7 1.7 0 0 1 1.1 1.7c0 .4-.1.7-.5 1l-1.2.2c-.5 0-1 0-1.3-.2-.4-.2-.6-.5-.6-.8l.2-.1h.1l.2.1.6.4.8.1c.4 0 .7 0 .9-.2.2-.1.3-.4.3-.7l-.3-.6c-.1-.2-.3-.4-.6-.5l-.8-.1c-.6 0-1 .1-1.4.4-.3.3-.4.7-.4 1.3 0 1 .2 2 .3 2.6.1.7.4 1.3.7 1.8l-.1.1-.3.3Zm4.5-3.7a22.2 22.2 0 0 1-.5-5.4v-1.3l.3-.1h.2v.3a54.3 54.3 0 0 0 .2 5.2l.1 1.2-.2.1h-.1Zm3.5.1c-.5 0-.8 0-1.2-.3-.4-.1-.7-.4-.9-.7-.2-.3-.3-.6-.3-1 0-.5.1-.9.3-1.3.1-.4.4-.7.7-1 .3-.1.7-.3 1.1-.3.5 0 .8.2 1 .5.3.3.4.6.4 1 0 .5-.2.8-.5 1a2 2 0 0 1-1.2.3h-.3l-.5-.2-.1-.2v-.1H104.6c.6 0 1-.2 1-.8 0-.3-.2-.5-.3-.7 0-.2-.3-.3-.6-.3s-.6 0-.8.3c-.3.1-.5.3-.6.6a2 2 0 0 0-.2.9c0 .5.1 1 .4 1.3.3.3.8.5 1.4.5h.6a13.5 13.5 0 0 1 .9-.3h.2c-.2.3-.4.5-.8.6a3 3 0 0 1-1 .2Zm2.1-1.2h.5c.1 0 .2 0 .3.2l.2.1.6.3h.9l.9-.1c.2-.1.4-.3.4-.5l-.2-.5-.6-.3-.8-.1-1-.2c-.4 0-.6-.2-.7-.4-.2-.2-.3-.4-.3-.8 0-.3.2-.6.5-.8l1.2-.3c.4 0 .7.1 1 .3.3.2.5.4.5.7l-.1.5-.3.1-.1-.2v-.4c0-.1 0-.2-.3-.3l-.6-.1c-.4 0-.7 0-.9.2-.2.1-.3.3-.3.5s0 .3.2.4l.6.2 1 .2.8.1c.3.1.5.2.6.4.2.2.2.5.2.8 0 .4-.1.7-.5.9-.3.2-.7.3-1.2.3a4 4 0 0 1-1.6-.3c-.5-.2-.8-.5-.9-.9ZM2.3 23.1c0 .2.2.2.3.1l2-1.2a.3.3 0 0 0-.4-.4l-1.6 1L1.5 21a.2.2 0 0 0-.4.3L2.3 23Zm.4 0c.5-2.4 1.8-4.4 3.4-6.1 1.6-1.8 3.6-3.4 5.4-4.9A24 24 0 0 0 15.9 8c.4-.7.8-1.4.9-2.2 0-.8-.1-1.5-.6-2.3l-.4.2c.4.7.5 1.4.5 2-.1.7-.4 1.3-.9 2-.9 1.3-2.5 2.7-4.2 4.1-1.8 1.5-3.8 3.1-5.4 5-1.7 1.7-3 3.8-3.5 6.2l.4.2ZM16.2 3.4C14.4.2 10.5 0 8 1.3 6.8 1.9 6 3 5.8 4.3c-.1 1.4.6 2.9 2.5 4.4l.4-.4c-1.9-1.5-2.5-2.8-2.4-4 0-1 .8-2 2-2.6 2.2-1.2 5.8-1 7.5 2l.4-.3ZM8.3 8.7C16 14.7 24 17 32 17v-.5C24 16.5 16 14.3 8.7 8.3l-.4.4ZM141.3 22.1c0 .1.2.2.3.1l2-1.2a.2.2 0 0 0-.3-.4l-1.7 1-1-1.7a.3.3 0 0 0-.5.3l1.2 2Zm.4 0c1.2-4.7.5-7.4-1.5-8.8-1-.6-2.1-1-3.5-1-1.4-.1-3 0-4.6.3-3.2.6-6.8 1.8-9.9 2.7l-4.2 1.1c-1.3.3-2.3.4-3 .2v.5c.8.2 1.8 0 3.1-.2l4.3-1.1c3.1-1 6.6-2 9.8-2.7 1.6-.3 3.1-.4 4.5-.3 1.3 0 2.4.3 3.3 1 1.6 1.1 2.4 3.5 1.3 8.1l.4.2Z"
      />
    </svg>

    <div class="mx-6">
      <div class="mx-auto text-sm md:text-base max-w-5xl">
        <div class="-mx-4 mt-5 flex flex-wrap">
          <div
            v-for="(example, index) in examples"
            :key="index"
            :class="['w-1/2 lg:w-1/4 group cursor-pointer']"
            @click="selectedExample = example"
          >
            <div
              :class="
                'bg-gray-100 dark:bg-gray-900 p-4 rounded-lg group-hover:bg-gray-200 dark:group-hover:bg-gray-700 border-2 m-4' +
                (selectedExample?.id && selectedExample?.id === example?.id
                  ? '  border-blue-500'
                  : ' border-transparent')
              "
            >
              <h2 class="text-lg font-semibold mb-2">{{ example.title }}</h2>
              <p>{{ example.description }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="bg-gradient-to-t from-red-50 dark:from-gray-700 w-full relative overflow-hidden pb-40"
    >
      <div class="mt-4 mx-6 text-sm md:text-base">
        <BrowserWindow>
          <TransitionGroup
            tag="ul"
            v-if="selectedExample"
            class="chat-list mt-5 flex flex-col w-[90%] mx-auto"
            enter-active-class="transition ease-out duration-200"
            enter-from-class="opacity-0 translate-y-10"
            enter-to-class="opacity-100 translate-y-0"
            leave-active-class="transition ease-in duration-150"
            leave-from-class="opacity-100 translate-y-0"
            leave-to-class="opacity-0 translate-y-10"
          >
            <li
              v-for="(chatItem, index) in displayChats"
              :key="index"
              :class="
                chatItem.type === 'question'
                  ? 'question rounded-lg px-4 py-3 bg-[#e6f2dd] dark:bg-gray-700 ml-auto mb-6 md:max-w-[70%] max-w-[90%]'
                  : 'answer rounded-lg px-4 py-3 md:max-w-[70%] max-w-[90%] mr-auto bg-[#eef9ff] dark:bg-gray-800 mb-6'
              "
            >
              <p v-if="chatItem.text">{{ chatItem.text }}</p>
              <div
                v-else-if="chatItem.html"
                v-html="chatItem.html"
                class="prose prose-ul:mt-0 prose-li:m-0"
              ></div>
              <p v-else>...</p>
              <img
                v-if="chatItem.image"
                :src="chatItem.image"
                alt="AI"
                class="w-full mt-2 mb-1 rounded-xl dark:opacity-50"
              />
            </li>
          </TransitionGroup>

          <div
            v-if="!selectedExample"
            class="mt-5 flex flex-col w-[90%] mx-auto"
          >
            <div
              class="rounded-lg px-4 py-3 bg-gray-100 dark:bg-gray-800 mt-10 mx-auto mb-6 md:max-w-[70%] max-w-[90%]"
            >
              <p>Hi there 👋</p>
              <p class="mt-2">
                I'm the Simple Analytics' AI and here to help you with your
                data.
              </p>
              <p>
                Choose one of the examples above this window to get started.
              </p>
              <p class="mt-2">
                <span class="font-bold">Notice: </span>
                <span class="italic"
                  >This is a static demo, scroll down for the real deal.</span
                >
              </p>
            </div>
          </div>

          <div
            class="mt-auto pointer-events-none text-gray-300 border dark:border-transparent dark:bg-gray-800 rounded-3xl w-2/3 md:w-1/2 px-2 py-1 md:px-3 md:py-2 mx-auto mb-6 scroll-mb-10"
            ref="textInput"
          >
            <span v-if="selectedExample && typingText">{{ typingText }}</span>
            <span v-else-if="selectedExample"
              >Start typing...
              <span class="opacity-50">({{ $t("ai.not_really") }})</span></span
            >
            <span v-else>{{ $t("ai.choose_above_examples") }}...</span>
          </div>
        </BrowserWindow>
      </div>
    </div>

    <div class="-mt-60 pt-48 relative overflow-hidden">
      <ClientOnly>
        <div class="absolute top-0 left-1/2 transform -translate-x-1/2">
          <BackgroundChart
            class="fill-blue-50 stroke-red-500 dark:stroke-red-600 dark:fill-gray-800"
          />
        </div>
      </ClientOnly>

      <div class="bg-blue-50 dark:bg-gray-800 pb-20 -mb-10">
        <div class="max-w-5xl mx-auto text-center pt-20 px-6">
          <h2 class="text-2xl md:text-3xl font-medium mt-8">
            Play with public data yourself
          </h2>
          <p class="mt-4">Opens a Simple Analytics' chat window in a new tab</p>
          <div class="-mx-4 mt-5 flex flex-wrap">
            <a
              class="w-full sm:w-1/2 lg:w-1/3 p-4 group cursor-pointer"
              href="https://simpleanalytics.com/ai/simpleanalytics.com"
              target="_blank"
            >
              <div
                class="bg-blue-100 dark:bg-gray-700 p-4 rounded-lg transform transition-transform group-hover:scale-105"
              >
                <LogosSimpleAnalytics class="h-20 w-auto mx-auto mt-2 mb-4" />
                <h2 class="text-lg font-semibold mb-2">Simple Analytics</h2>
                <p>Privacy-first web analytics</p>
              </div>
            </a>
            <a
              class="w-full sm:w-1/2 lg:w-1/3 p-4 group cursor-pointer"
              href="https://simpleanalytics.com/ai/bannerbear.com"
              target="_blank"
            >
              <div
                class="bg-blue-100 dark:bg-gray-700 p-4 rounded-lg transform transition-transform group-hover:scale-105"
              >
                <LogosBannerbear class="h-16 w-auto mx-auto mt-4 mb-6" />
                <h2 class="text-lg font-semibold mb-2">Bannerbear</h2>
                <p>API for social media images</p>
              </div>
            </a>
            <a
              class="w-full sm:w-1/2 lg:w-1/3 p-4 group cursor-pointer"
              href="https://simpleanalytics.com/ai/nomadlist.com"
              target="_blank"
            >
              <div
                class="bg-blue-100 dark:bg-gray-700 p-4 rounded-lg transform transition-transform group-hover:scale-105"
              >
                <LogosNomadList class="h-20 w-auto mx-auto mt-2 mb-4" />

                <h2 class="text-lg font-semibold mb-2">Nomad List</h2>
                <p>Find cities to live remotely</p>
              </div>
            </a>
          </div>
        </div>

        <div class="mt-20 text-center">
          <StartTrial
            :buttonText="$t('start_trial.try_it_with_your_analytics')"
          />
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, nextTick, computed } from "vue";
import BackgroundChart from "~/components/images/BackgroundChart.vue";

definePageMeta({
  title: "Simple Analytics' AI",
  description:
    "Chat with your analytics data and generate insights and beautiful charts.",
  image: "https://assets.simpleanalytics.com/social-media/ai-social-image.png",
});

useSeoMeta({
  title: "Simple Analytics' AI - Chat with your analytics",
  ogTitle: "Simple Analytics' AI - Chat with your analytics",
  description:
    "Chat with your analytics data and generate insights and beautiful charts.",
  ogDescription:
    "Chat with your analytics data and generate insights and beautiful charts.",
  ogImage:
    "https://assets.simpleanalytics.com/social-media/ai-social-image.png",
  twitterImage:
    "https://assets.simpleanalytics.com/social-media/ai-social-image.png",
  twitterCard: "summary_large_image",
});

const tColorsRed = [`<span class='text-red-500 dark:text-red-600'>`, `</span>`];
const tBlockRed = [
  `<span class='inline-block text-base md:text-xl font-medium bg-gradient-to-b from-red-400 to-red-500 dark:from-red-700 dark:to-red-600 dark:text-gray-800 ml-2 py-1 px-2 rounded' style="line-height: 1">`,
  `</span>`,
];

const examples = [
  {
    id: "1",
    title: "Smart insights",
    description: "Get amazing insights into your traffic",
    chat: [
      {
        type: "question",
        text: "Give me insights into my traffic last month",
      },
      {
        type: "answer",
        html: `<p>Last month (October 2023), your website simpleanalytics.com had the following traffic:</p>
<ul>
<li>Pageviews: 36,593</li>
<li>Visitors: 21,798</li>
</ul>

<p>Comparing this to the previous month (September 2023), where you had:</p>
<ul>
<li>Pageviews: 46,085</li>
<li>Visitors: 29,743</li>
</ul>

<p>There has been a decrease in traffic from September to October:</p>

<ul>
<li>Pageviews decreased by 9,492 (-20.62%)</li>
<li>Visitors decreased by 7,945 (-26.71%)</li>
</ul>

<p>Based on this data, you might want to analyze what events took place between September and October that may have influenced the drop in traffic. You could consider examining changes to your marketing strategies, any site issues, or external factors such as seasonality or industry trends. Investigating the cause and then addressing it would be beneficial to regain the traction lost.</p>

<p>Would you like to dive deeper into specifics, like page performance, traffic sources, or visitor demographics?</p>`,
      },
      {
        type: "question",
        text: "Yes, show me top 5 growing traffic sources.",
      },
      {
        type: "answer",
        html: `<p>Based on the data from Simple Analytics, here are the top 5 growing traffic sources during the period from 2023-10-29 to 2023-11-29 compared to the previous period:</p>
<ol>
<li><strong>Google</strong>:<ul>
<li>Visitors increased from 4864 to 5712 (+17.45%)</li>
</ul>
</li>
<li><strong>Twitter</strong>:<ul>
<li>Visitors increased from 1032 to 2899 (+181.01%)</li>
</ul>
</li>
<li><strong>Bing</strong>:<ul>
<li>Visitors increased from 226 to 293 (+29.65%)</li>
</ul>
</li>
<li><strong>Docs (Simple Analytics Documentation)</strong>:<ul>
<li>Visitors increased from 227 to 269 (+18.50%)</li>
</ul>
</li>
<li><strong>Reddit</strong>:<ul>
<li>Visitors increased from 211 to 259 (+22.75%)</li>
</ul>
</li>
</ol>
<p>These sources are the ones that showed the most growth in traffic when comparing the last month&#39;s data with the data from the month before. It would be beneficial for your website to focus on these sources and possibly increase marketing efforts or engage more with the audience coming from these channels.</p>`,
      },
    ],
  },
  {
    id: "2",
    title: "Comparing visitors",
    description: "Comparing visitors between weeks",
    chat: [
      {
        type: "question",
        text: "Compare my visitors between this week and last week in a line chart. Explain what you see.",
      },
      {
        type: "answer",
        html: `<p>The line chart compares the number of visitors to simpleanalytics.com for the current week (Nov 22 - Nov 28) and the previous week (Nov 15 - Nov 21). Here's what we can observe:</p>
<ul>
<li>Overall, there has been a noticeable decrease in visitors this week compared to last week. The total visitors decreased from 5,757 to 5,307.</li>
<li>The highest number of visitors for both weeks was on Wednesday, with a more significant peak last week.</li>
<li>The lowest visitor counts for both weeks occurred on weekends, which is consistent with typical user behavior, where visits to business or analytics sites drop off during those days.</li>
<li>Despite the overall decrease, the patterns of visitor numbers throughout the weeks are similar, with peaks around the beginning and the middle of the week, and troughs during the weekend.</li>
</ul>
<p>Here is the visual representation of this comparison:</p>`,
        image:
          "https://assets.simpleanalytics.com/images/homepage/ai-chart-line.png",
      },
    ],
  },
  {
    id: "3",
    title: "Traffic sources",
    description: "Generate charts with grouped traffic sources",
    chat: [
      {
        type: "question",
        text: "Create a Pie chart of traffic sources grouped by “organic”, “social”, and “other”",
      },
      {
        type: "answer",
        text: `Here's a pie chart showing the distribution of traffic sources categorized as "Organic," "Social," and "Other":`,
        image:
          "https://assets.simpleanalytics.com/images/homepage/ai-chart-pie.png",
      },
    ],
  },
  {
    id: "4",
    title: "Generate a Tweet",
    description: "Make a social media image of your data",
    chat: [
      {
        type: "question",
        text: "Make a tweet with the most popular /sale/ pages (excluding) /sale/, list the top 5 pages.",
      },
      {
        type: "answer",
        html: `
          <p>🐕🎉 Check out the top trending pages on our sale section this month and find your new best friend!</p>
          <ol>
            <li>🐾 Dachshund deals: 49,265 views</li>
            <li>🌟 Golden Retriever goldmine: 36,582 views</li>
            <li>🦮 German Shepherd gems: 32,283 views</li>
            <li>🐶 Cockapoo corner: 30,580 views</li>
            <li>🐕 Labrador lane: 27,661 views</li>
          </ol>
          <p>Find them all on <a href="https://dogs.ie/?utm_source=simpleanalytics.com&utm_medium=ai" target="_blank">dogs.ie</a> #DogLovers #PetSale #TopDogs</p>
        `,
        image:
          "https://assets.simpleanalytics.com/images/homepage/ai-chart-tweet.png",
      },
    ],
  },

  // - Give me insights into my traffic last month
];

const selectedExample = ref();
const displayChats = ref([]);
const typingText = ref(""); // Holds the current state of the typing animation
const textInput = ref(null); // Ref to the text input element

const displayChatsLength = computed(() => displayChats.value.length);

const typeText = async (text) => {
  typingText.value = ""; // Reset typing text
  let delay = Math.max(40, Math.random() * 60); // Initial delay for the first word

  // Firefox does not support scrollIntoViewIfNeeded, let's fallback
  if (document.documentElement.scrollIntoViewIfNeeded) {
    textInput.value.scrollIntoViewIfNeeded(false);
  } else {
    textInput.value.scrollIntoView({ behavior: "smooth", block: "end" });
  }

  for (const [index, char] of Array.from(text).entries()) {
    typingText.value += char;

    // Check for space or start of text to set new delay
    if (char === " " || index === 0) {
      delay = Math.max(15, Math.random() * 60);
    }

    await new Promise((resolve) => setTimeout(resolve, delay));
  }

  typingText.value = ""; // Reset typing text
};

const addChatsSequentially = async () => {
  if (!selectedExample.value || !selectedExample.value.chat) return;

  displayChats.value = []; // Reset the display list

  for (const chatItem of selectedExample.value.chat) {
    if (chatItem.type === "question") {
      // Add timeout for the transition to finish
      await new Promise((resolve) => setTimeout(resolve, 210));

      await typeText(chatItem.text);
      displayChats.value.push(chatItem);
    } else {
      const delay = displayChats.value.length === 0 ? 100 : 1500;
      await new Promise((resolve) => setTimeout(resolve, delay));
      displayChats.value.push(chatItem);
    }
  }
};

watch(selectedExample, (newVal, oldVal) => {
  if (newVal !== oldVal) {
    addChatsSequentially();
  }
});

// Scroll to button of last message
watch(
  displayChatsLength,
  (newVal, oldVal) => {
    if (newVal !== oldVal && newVal) {
      nextTick(() => {
        const lastChat = document.querySelector(
          "ul.chat-list li.answer:last-child",
        );

        if (!lastChat) return;

        // Detect if the last chat is visible
        const lastChatRect = lastChat.getBoundingClientRect();
        const lastChatVisible =
          lastChatRect.top >= 0 &&
          lastChatRect.left >= 0 &&
          lastChatRect.bottom <=
            (window.innerHeight || document.documentElement.clientHeight) &&
          lastChatRect.right <=
            (window.innerWidth || document.documentElement.clientWidth);

        if (!lastChatVisible) {
          lastChat.scrollIntoView({ behavior: "smooth", block: "end" });
        }
      });
    }
  },
  { deep: true },
);
</script>

<style>
div.prose p + ul {
  margin-top: -1rem;
}
</style>
